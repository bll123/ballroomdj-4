#
# Copyright 2023 Brad Lanam Pleasant Hill CA
#
# This makefile uses the gnu make grouped-target extension

# SLOCALE must be set to the short locale name
# LOCALE must be set to the long locale name
# LANGDESC must be set to the language description

TMPLDIR = ../templates
PODIR = po

PLAYLISTS = \
	$(TMPLDIR)/$(SLOCALE)/automatic.pl \
	$(TMPLDIR)/$(SLOCALE)/automatic.pldances \
	$(TMPLDIR)/$(SLOCALE)/QueueDance.pl \
	$(TMPLDIR)/$(SLOCALE)/QueueDance.pldances \
	$(TMPLDIR)/$(SLOCALE)/standardrounds.pl \
	$(TMPLDIR)/$(SLOCALE)/standardrounds.pldances \
	$(TMPLDIR)/$(SLOCALE)/standardrounds.sequence

DATAFILES = \
	$(TMPLDIR)/$(SLOCALE)/bdjconfig.q0.txt \
	$(TMPLDIR)/$(SLOCALE)/bdjconfig.q1.txt \
	$(TMPLDIR)/$(SLOCALE)/bdjconfig.q2.txt \
	$(TMPLDIR)/$(SLOCALE)/bdjconfig.q3.txt \
	$(TMPLDIR)/$(SLOCALE)/bdjconfig.q4.txt \
	$(TMPLDIR)/$(SLOCALE)/bdjconfig.txt.p \
	$(TMPLDIR)/$(SLOCALE)/dances.txt \
	$(TMPLDIR)/$(SLOCALE)/dancetypes.txt \
	$(TMPLDIR)/$(SLOCALE)/genres.txt \
	$(TMPLDIR)/$(SLOCALE)/itunes-stars.txt \
	$(TMPLDIR)/$(SLOCALE)/levels.txt \
	$(TMPLDIR)/$(SLOCALE)/ratings.txt \
	$(TMPLDIR)/$(SLOCALE)/status.txt

HTMLFILES = \
	$(TMPLDIR)/$(SLOCALE)/bdj-flex-dark.html \
	$(TMPLDIR)/$(SLOCALE)/bdj-flex.html \
	$(TMPLDIR)/$(SLOCALE)/bdj.html

all: $(PLAYLISTS) $(DATAFILES) $(HTMLFILES)

# all of the different templates have different strings that need to
# be pulled out to process.  the script handles this, so use the make
# group-targets to only run this once.
$(PLAYLISTS) $(DATAFILES) &:	$(PODIR)/$(LOCALE).po po-tmpl.sh
	@./po-tmpl.sh $(PODIR)/$(LOCALE).po $(LOCALE) $(SLOCALE)

$(HTMLFILES) &:   $(PODIR)/$(LOCALE).po po-html.sh
	@./po-html.sh $(PODIR)/$(LOCALE).po \
            $(LOCALE) $(SLOCALE) "$(LANGDESC)"
