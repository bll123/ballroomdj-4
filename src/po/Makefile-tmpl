#
# Copyright 2023 Brad Lanam Pleasant Hill CA
#
# This makefile uses the gnu make grouped-target extension

# SLOCALE must be set to the short locale name
# LOCALE must be set to the long locale name
# LANGDESC must be set to the language description

# starts in src/po directory
TMPLDIR = ../../templates
PODIR = po

PLAYLISTSRC = $(TMPLDIR)/automatic.pl \
	$(TMPLDIR)/automatic.pldances \
	$(TMPLDIR)/QueueDance.pl \
	$(TMPLDIR)/QueueDance.pldances \
	$(TMPLDIR)/standardrounds.pl \
	$(TMPLDIR)/standardrounds.pldances \
	$(TMPLDIR)/standardrounds.sequence

DATAFILESRC = \
	$(TMPLDIR)/bdjconfig.q0.txt \
	$(TMPLDIR)/bdjconfig.q1.txt \
	$(TMPLDIR)/bdjconfig.q2.txt \
	$(TMPLDIR)/bdjconfig.q3.txt \
	$(TMPLDIR)/bdjconfig.q4.txt \
	$(TMPLDIR)/bdjconfig.txt.p \
	$(TMPLDIR)/dances.txt \
	$(TMPLDIR)/dancetypes.txt \
	$(TMPLDIR)/genres.txt \
	$(TMPLDIR)/itunes-stars.txt \
	$(TMPLDIR)/levels.txt \
	$(TMPLDIR)/ratings.txt \
	$(TMPLDIR)/status.txt

HTMLFILESRC = \
	$(TMPLDIR)/bdj-flex-dark.html \
	$(TMPLDIR)/bdj-flex.html \
	$(TMPLDIR)/bdj.html

PLAYLISTS = $(TMPLDIR)/$(SLOCALE)/automatic.pl \
	$(TMPLDIR)/$(SLOCALE)/automatic.pldances \
	$(TMPLDIR)/$(SLOCALE)/QueueDance.pl \
	$(TMPLDIR)/$(SLOCALE)/QueueDance.pldances \
	$(TMPLDIR)/$(SLOCALE)/standardrounds.pl \
	$(TMPLDIR)/$(SLOCALE)/standardrounds.pldances \
	$(TMPLDIR)/$(SLOCALE)/standardrounds.sequence

DATAFILES = \
	$(TMPLDIR)/$(SLOCALE)/bdjconfig.q0.txt \
	$(TMPLDIR)/$(SLOCALE)/bdjconfig.q1.txt \
	$(TMPLDIR)/$(SLOCALE)/bdjconfig.q2.txt \
	$(TMPLDIR)/$(SLOCALE)/bdjconfig.q3.txt \
	$(TMPLDIR)/$(SLOCALE)/bdjconfig.q4.txt \
	$(TMPLDIR)/$(SLOCALE)/bdjconfig.txt.p \
	$(TMPLDIR)/$(SLOCALE)/dances.txt \
	$(TMPLDIR)/$(SLOCALE)/dancetypes.txt \
	$(TMPLDIR)/$(SLOCALE)/genres.txt \
	$(TMPLDIR)/$(SLOCALE)/itunes-stars.txt \
	$(TMPLDIR)/$(SLOCALE)/levels.txt \
	$(TMPLDIR)/$(SLOCALE)/ratings.txt \
	$(TMPLDIR)/$(SLOCALE)/status.txt

HTMLFILES = \
	$(TMPLDIR)/$(SLOCALE)/bdj-flex-dark.html \
	$(TMPLDIR)/$(SLOCALE)/bdj-flex.html \
	$(TMPLDIR)/$(SLOCALE)/bdj.html

.PHONY: all
all: $(PLAYLISTS) $(DATAFILES) $(HTMLFILES)
	@:

# all of the different templates have different strings that need to
# be pulled out to process.  the script handles this, so use the make
# group-targets to only run this once.
$(PLAYLISTS) $(DATAFILES) &:	$(PLAYLISTSRC) $(DATAFILESRC) \
		$(PODIR)/$(LOCALE).po po-tmpl.sh
	echo "-- $(date +%T) Update templates for $(SLOCALE)"
	@./po-tmpl.sh $(PODIR)/$(LOCALE).po $(LOCALE) $(SLOCALE)

$(HTMLFILES) &:   $(HTMLFILESRC) $(PODIR)/$(LOCALE).po po-html.sh
	@./po-html.sh $(PODIR)/$(LOCALE).po \
            $(LOCALE) $(SLOCALE) "$(LANGDESC)"

