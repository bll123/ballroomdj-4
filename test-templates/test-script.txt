# 2022-9-11
# test songs are all approximately 30 seconds long
#
# main:
#   status:
#     mqmanage mqplay mqmlen mqplen dbidx m-songfn title dance
# player:
#   status:
#     playstate plistate currvolume realvolume speed playtimeplayed
#     pauseatend repeat defaultsink currentsink
#   song:
#     p-duration p-songfn

section Basic

test Init
msg main QUEUE_PLAY_ON_ADD 0
msg main QUEUE_SWITCH_EMPTY 0
msg main MUSICQ_SET_MANAGE 0
msg main MUSICQ_SET_PLAYBACK 0
reset

test Insert-Play
get main CHK_MAIN_MUSICQ
chk mqplen 0
msg main MUSICQ_INSERT 0~99~0
get main CHK_MAIN_MUSICQ
chk mqplen 1
msg main CMD_PLAY
mssleep 500
get main CHK_MAIN_MUSICQ
get player CHK_PLAYER_STATUS
chk mqplen 1 dbidx 0 playstate playing
mssleep 2000
get player CHK_PLAYER_STATUS
chk playstate playing
resptimeout 35000
get player CHK_PLAYER_STATUS
wait playstate stopped
get main CHK_MAIN_MUSICQ
chk mqplen 0
end

test Insert-Play-2
get main CHK_MAIN_MUSICQ
chk mqplen 0
msg main MUSICQ_INSERT 0~99~1
get main CHK_MAIN_MUSICQ
chk mqplen 1
msg main CMD_PLAY
mssleep 500
get main CHK_MAIN_MUSICQ
get player CHK_PLAYER_STATUS
chk mqplen 1 dbidx 1 playstate playing
mssleep 2000
msg main MUSICQ_INSERT 0~99~2
get main CHK_MAIN_MUSICQ
get player CHK_PLAYER_STATUS
chk mqplen 2 dbidx 1 playstate playing
resptimeout 35000
get player CHK_PLAYER_STATUS
wait playstate in-fadeout
wait playstate in-gap
wait playstate playing
get main CHK_MAIN_MUSICQ
chk mqplen 1 dbidx 2
get player CHK_PLAYER_STATUS
wait playstate stopped
get main CHK_MAIN_MUSICQ
chk mqplen 0
end
