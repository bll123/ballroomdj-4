section 50 Playback-Controls-Advanced

test 50-20 Repeat-Next-Song
msg main MUSICQ_INSERT 0~999~15
msg main MUSICQ_INSERT 0~999~17
msg main MUSICQ_INSERT 0~999~19
msg main CMD_PLAY
mssleep 1000
get player CHK_PLAYER_STATUS
resptimeout 1000
wait playstate playing
chk pauseatend 0 playstate playing repeat 0 prepqueuecount 2
get main CHK_MAIN_MUSICQ
chk dbidx 15
msg player PLAY_REPEAT
get player CHK_PLAYER_STATUS
chk pauseatend 0 playstate playing repeat 1 prepqueuecount 2
msg main CMD_NEXTSONG
get player CHK_PLAYER_STATUS
mssleep 1000
get player CHK_PLAYER_STATUS
resptimeout 1000
wait playstate playing
get main CHK_MAIN_MUSICQ
chk dbidx 17
get player CHK_PLAYER_STATUS
chk pauseatend 0 playstate playing repeat 0 prepqueuecount 1
end

# repeat and pause-at-end must work correctly together
test 50-30 Repeat-Pause-At-End
msg main MUSICQ_INSERT 0~999~15
msg main MUSICQ_INSERT 0~999~17
# make sure the pause-at-end works w/repeat.
msg main CMD_PLAY
mssleep 1000
get player CHK_PLAYER_STATUS
resptimeout 1000
wait playstate playing
chk pauseatend 0 playstate playing repeat 0
msg player PLAY_REPEAT
msg player PLAY_PAUSEATEND
get main CHK_MAIN_MUSICQ
chk mq0len 2 dbidx 15 mq0idx0 15 mq0idx1 17
get player CHK_PLAYER_STATUS
chk pauseatend 1 playstate playing repeat 1
msg player PLAY_FADE
get player CHK_PLAYER_STATUS
resptimeout 2000
wait playstate in-fadeout
resptimeout 7000
wait playstate stopped
get main CHK_MAIN_MUSICQ
chk mq0len 2 mq0idx0 15 mq0idx1 17
get player CHK_PLAYER_STATUS
chk pauseatend 0 playstate stopped repeat 1
# make sure the next playback continues on and does not pause
msg main CMD_PLAY
get player CHK_PLAYER_STATUS
resptimeout 2000
wait playstate playing
chk pauseatend 0 playstate playing repeat 1
msg player PLAY_FADE
get player CHK_PLAYER_STATUS
resptimeout 1000
wait playstate in-fadeout
resptimeout 7000
wait playstate playing
chk pauseatend 0 playstate playing repeat 1
end
