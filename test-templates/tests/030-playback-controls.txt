section 30 Playback-Controls

test 30-10 Fade
msg main MUSICQ_INSERT 0~999~9
msg main CMD_PLAY
get player CHK_PLAYER_STATUS
resptimeout 1000
wait playstate playing
mssleep 1000
msg player PLAY_FADE
resptimeout 5000
get player CHK_PLAYER_STATUS
chk playstate in-fadeout
# a fade during in-fadeout does nothing
msg player PLAY_FADE
get player CHK_PLAYER_STATUS
chk playstate in-fadeout
wait playstate in-gap
end

test 30-20 Pause-at-End
msg main MUSICQ_INSERT 0~999~10
msg main CMD_PLAY
resptimeout 2000
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1000
get player CHK_PLAYER_STATUS
chk pauseatend 0 playstate playing
msg player PLAY_PAUSEATEND
get player CHK_PLAYER_STATUS
chk pauseatend 1 playstate playing
msg player PLAY_PAUSEATEND
get player CHK_PLAYER_STATUS
chk pauseatend 0 playstate playing
msg player PLAY_PAUSEATEND
get player CHK_PLAYER_STATUS
chk pauseatend 1 playstate playing
# after the song stops, the player will be in the stopped state
msg player PLAY_FADE
get player CHK_PLAYER_STATUS
chk pauseatend 1 playstate in-fadeout
get player CHK_PLAYER_STATUS
resptimeout 5000
wait playstate stopped
get player CHK_PLAYER_STATUS
chk pauseatend 0 playstate stopped
end

test 30-30 Play-Pause
msg main MUSICQ_INSERT 0~999~11
msg main CMD_PLAY
get player CHK_PLAYER_STATUS
resptimeout 2000
wait playstate playing
mssleep 1000
get main CHK_MAIN_MUSICQ
chk mq0len 1 dbidx 11
msg main CMD_PLAYPAUSE
get player CHK_PLAYER_STATUS
chk playstate paused
get main CHK_MAIN_MUSICQ
chk mq0len 1 qdbidx 11
msg main CMD_PLAYPAUSE
get player CHK_PLAYER_STATUS
chk playstate playing
get main CHK_MAIN_MUSICQ
chk mq0len 1 dbidx 11
msg main CMD_PLAYPAUSE
get player CHK_PLAYER_STATUS
chk playstate paused
get main CHK_MAIN_MUSICQ
chk mq0len 1 qdbidx 11
msg main CMD_PLAYPAUSE
get player CHK_PLAYER_STATUS
chk playstate playing
get main CHK_MAIN_MUSICQ
chk mq0len 1 dbidx 11
# a pause during in-fadeout creates a pause-at-end condition
msg player PLAY_FADE
get player CHK_PLAYER_STATUS
resptimeout 1000
wait playstate in-fadeout
get player CHK_PLAYER_STATUS
chk pauseatend 0 playstate in-fadeout
msg main CMD_PLAYPAUSE
get player CHK_PLAYER_STATUS
chk pauseatend 1 playstate in-fadeout
resptimeout 6500
get player CHK_PLAYER_STATUS
wait playstate stopped
end

test 30-40 Position
# test while playing
msg main MUSICQ_INSERT 0~999~3
msg main MUSICQ_INSERT 0~999~4
get main CHK_MAIN_MUSICQ
chk mq0len 2
msg main CMD_PLAY
mssleep 500
get player CHK_PLAYER_STATUS
resptimeout 2000
wait playstate playing
mssleep 1000
msg player PLAY_SEEK 25000
get player CHK_PLAYER_STATUS
chk-gt playtimeplayed 25000
get player CHK_PLAYER_STATUS
chk-lt playtimeplayed 26000
msg player PLAY_SEEK 5000
get player CHK_PLAYER_STATUS
chk-gt playtimeplayed 5000
get player CHK_PLAYER_STATUS
chk-lt playtimeplayed 6000
msg player PLAY_SEEK 10000
get player CHK_PLAYER_STATUS
chk-gt playtimeplayed 10000
get player CHK_PLAYER_STATUS
chk-lt playtimeplayed 11000
msg player PLAY_SEEK 0
get player CHK_PLAYER_STATUS
chk-gt playtimeplayed 0
get player CHK_PLAYER_STATUS
chk-lt playtimeplayed 1000
msg player PLAY_SEEK 28000
resptimeout 4000
get player CHK_PLAYER_STATUS
wait playstate in-fadeout
end

# nextsong is used internally by the 'end' command
test 30-50 Next-Song
# first test when the player is stopped
print stopped
msg main CHK_MAIN_RESET
msg main MUSICQ_INSERT 0~999~5
msg main MUSICQ_INSERT 0~999~6
msg main MUSICQ_INSERT 0~999~7
msg main MUSICQ_INSERT 0~999~8
get main CHK_MAIN_MUSICQ
chk mq0len 4 qdbidx 5
get player CHK_PLAYER_STATUS
chk playstate stopped
msg main CMD_NEXTSONG
mssleep 100
get player CHK_PLAYER_STATUS
chk playstate stopped
get main CHK_MAIN_MUSICQ
chk mq0len 3 qdbidx 6
msg main CMD_NEXTSONG
mssleep 100
get player CHK_PLAYER_STATUS
chk playstate stopped
get main CHK_MAIN_MUSICQ
chk mq0len 2 qdbidx 7
msg main CMD_NEXTSONG
mssleep 100
get player CHK_PLAYER_STATUS
chk playstate stopped
get main CHK_MAIN_MUSICQ
chk mq0len 1 qdbidx 8
msg main CMD_NEXTSONG
mssleep 100
get player CHK_PLAYER_STATUS
chk playstate stopped
get main CHK_MAIN_MUSICQ
chk mq0len 0
# next test when the player is playing
print playing
msg main CHK_MAIN_RESET
msg main MUSICQ_INSERT 0~999~5
msg main MUSICQ_INSERT 0~999~6
msg main MUSICQ_INSERT 0~999~7
msg main MUSICQ_INSERT 0~999~8
msg main CMD_PLAY
get player CHK_PLAYER_STATUS
resptimeout 2000
wait playstate playing
mssleep 1000
get main CHK_MAIN_MUSICQ
chk mq0len 4 dbidx 5
get player CHK_PLAYER_STATUS
chk playstate playing
msg main CMD_NEXTSONG
mssleep 500
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1000
get main CHK_MAIN_MUSICQ
chk mq0len 3 dbidx 6
msg main CMD_NEXTSONG
mssleep 500
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1000
get main CHK_MAIN_MUSICQ
chk mq0len 2 dbidx 7
msg main CMD_NEXTSONG
mssleep 500
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1000
get main CHK_MAIN_MUSICQ
chk mq0len 1 dbidx 8
msg main CMD_NEXTSONG
mssleep 500
get player CHK_PLAYER_STATUS
chk playstate stopped
get main CHK_MAIN_MUSICQ
chk mq0len 0
# next test when the player is paused
print paused
msg main CHK_MAIN_RESET
msg main MUSICQ_INSERT 0~999~5
msg main MUSICQ_INSERT 0~999~6
msg main MUSICQ_INSERT 0~999~7
msg main MUSICQ_INSERT 0~999~8
msg main CMD_PLAY
mssleep 1000
msg main CMD_PLAYPAUSE
get player CHK_PLAYER_STATUS
resptimeout 2000
wait playstate paused
get main CHK_MAIN_MUSICQ
chk mq0len 4 qdbidx 5
get player CHK_PLAYER_STATUS
chk playstate paused
msg main CMD_NEXTSONG
mssleep 300
get player CHK_PLAYER_STATUS
chk playstate stopped
get main CHK_MAIN_MUSICQ
chk mq0len 3 qdbidx 6
msg main CMD_NEXTSONG
mssleep 300
get player CHK_PLAYER_STATUS
chk playstate stopped
get main CHK_MAIN_MUSICQ
chk mq0len 2 qdbidx 7
msg main CMD_NEXTSONG
mssleep 300
get player CHK_PLAYER_STATUS
chk playstate stopped
get main CHK_MAIN_MUSICQ
chk mq0len 1 qdbidx 8
msg main CMD_NEXTSONG
mssleep 300
get player CHK_PLAYER_STATUS
chk playstate stopped
get main CHK_MAIN_MUSICQ
chk mq0len 0
end

test 30-60 Repeat
msg main MUSICQ_INSERT 0~999~12
msg main MUSICQ_INSERT 0~999~13
msg main CMD_PLAY
resptimeout 2000
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1000
get main CHK_MAIN_MUSICQ
chk dbidx 12
mssleep 500
get player CHK_PLAYER_STATUS
chk repeat 0 playstate playing
get main CHK_MAIN_MUSICQ
chk dbidx 12
msg player PLAY_REPEAT
get player CHK_PLAYER_STATUS
chk repeat 1 playstate playing
get main CHK_MAIN_MUSICQ
chk dbidx 12
# same song
msg player PLAY_FADE
resptimeout 6500
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1000
get player CHK_PLAYER_STATUS
chk repeat 1 playstate playing
get main CHK_MAIN_MUSICQ
chk dbidx 12
# next song
msg player PLAY_REPEAT
get player CHK_PLAYER_STATUS
chk repeat 0 playstate playing
get main CHK_MAIN_MUSICQ
chk dbidx 12
msg player PLAY_FADE
resptimeout 6500
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1000
get player CHK_PLAYER_STATUS
chk repeat 0 playstate playing
get main CHK_MAIN_MUSICQ
chk dbidx 13
end

test 30-70 Beginning-of-Song
msg main MUSICQ_INSERT 0~999~13
get main CHK_MAIN_MUSICQ
chk mq0len 1
msg main CMD_PLAY
get player CHK_PLAYER_STATUS
resptimeout 2000
wait playstate playing
mssleep 1000
get player CHK_PLAYER_STATUS
chk-lt playtimeplayed 1500
msg player PLAY_SONG_BEGIN
get player CHK_PLAYER_STATUS
chk-lt playtimeplayed 200
mssleep 2000
get player CHK_PLAYER_STATUS
chk-gt playtimeplayed 2000
msg player PLAY_SONG_BEGIN
get player CHK_PLAYER_STATUS
chk-lt playtimeplayed 200
get player CHK_PLAYER_STATUS
chk playstate playing
## this needs to be implemented in the player
## song-begin during a fade does nothing
#mssleep 2000
#get player CHK_PLAYER_STATUS
#chk-gt playtimeplayed 2000
#msg player PLAY_FADE
#get player CHK_PLAYER_STATUS
#wait playstate in-fadeout
#msg player PLAY_SONG_BEGIN
#get player CHK_PLAYER_STATUS
#chk playstate in-fadeout
#get player CHK_PLAYER_STATUS
#disp playtimeplayed
#chk-gt playtimeplayed 2000
end

test 30-80 Volume
msg player PLAYER_VOLUME 20
msg main MUSICQ_INSERT 0~999~14
msg main CMD_PLAY
resptimeout 2000
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1000
get player CHK_PLAYER_STATUS
chk currvolume 20 realvolume 20
msg player PLAYER_VOLUME 30
get player CHK_PLAYER_STATUS
chk currvolume 30 realvolume 30
msg player PLAYER_VOLUME 40
get player CHK_PLAYER_STATUS
chk currvolume 40 realvolume 40
msg player PLAYER_VOLUME 20
get player CHK_PLAYER_STATUS
chk currvolume 20 realvolume 20
msg player PLAYER_VOLUME 35
end

test 30-90 Speed
msg main MUSICQ_INSERT 0~999~15
msg main MUSICQ_INSERT 0~999~16
msg main MUSICQ_INSERT 0~999~17
msg main CMD_PLAY
resptimeout 2000
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1000
get player CHK_PLAYER_STATUS
chk speed 100
msg player PLAY_SPEED 110
get player CHK_PLAYER_STATUS
chk speed 110
msg player PLAY_SPEED 90
get player CHK_PLAYER_STATUS
chk speed 90
msg player PLAY_FADE
resptimeout 6500
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1000
msg player PLAY_SPEED 130
get player CHK_PLAYER_STATUS
chk-gt playtimeplayed 1000
get player CHK_PLAYER_STATUS
chk-lt playtimeplayed 1200
msg player PLAY_FADE
resptimeout 7000
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1000
msg player PLAY_SPEED 70
get player CHK_PLAYER_STATUS
chk-gt playtimeplayed 1000
get player CHK_PLAYER_STATUS
chk-lt playtimeplayed 1200
end
