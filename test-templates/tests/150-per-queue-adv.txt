section 150 Per-Queue-Controls

# fixed in 4.0.1
test 150-10 Maximum-Play-Time
# use 20 seconds max for queue 0
msg main MUSICQ_SET_PLAYBACK 0
msg main CHK_MAIN_SET_MAXPLAYTIME 20000
# queue 1 has the maximum play time set to 10 seconds
# make sure gap is set to default
msg main MUSICQ_SET_PLAYBACK 1
msg main CHK_MAIN_SET_QUEUE_ACTIVE 1
msg main CHK_MAIN_SET_GAP 2000
msg main CHK_MAIN_SET_MAXPLAYTIME 10000
msg main MUSICQ_SET_PLAYBACK 0
#
msg main QUEUE_PLAYLIST 0~test-sl-a
msg main QUEUE_PLAYLIST 1~test-sl-a
#
msg main MUSICQ_SET_MANAGE 0
get main CHK_MAIN_MUSICQ
chk-gt mq0len 5
chk-gt mq1len 5
#
msg main CMD_PLAY
resptimeout 2000
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1500
get player CHK_PLAYER_STATUS
chk currvolume defaultvol actualvolume defaultvol
get player CHK_PLAYER_SONG
chk p-duration 20000
msg player PLAY_FADE
resptimeout 7500
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1500
get player CHK_PLAYER_STATUS
chk currvolume defaultvol actualvolume defaultvol
get player CHK_PLAYER_SONG
chk p-duration 20000
#
msg main MUSICQ_SET_PLAYBACK 1
msg player PLAY_FADE
resptimeout 7500
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1500
get player CHK_PLAYER_STATUS
chk currvolume defaultvol actualvolume defaultvol
get player CHK_PLAYER_SONG
chk p-duration 10000
#
msg main MUSICQ_SET_MANAGE 1
msg main MUSICQ_SET_PLAYBACK 0
msg player PLAY_FADE
resptimeout 7500
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1500
get player CHK_PLAYER_STATUS
chk currvolume defaultvol actualvolume defaultvol
get player CHK_PLAYER_SONG
chk p-duration 20000
#
msg main MUSICQ_SET_PLAYBACK 1
msg player PLAY_FADE
resptimeout 7500
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1500
get player CHK_PLAYER_STATUS
chk currvolume defaultvol actualvolume defaultvol
get player CHK_PLAYER_SONG
chk p-duration 10000
#
msg main MUSICQ_SET_PLAYBACK 0
msg player PLAY_FADE
resptimeout 7500
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1500
get player CHK_PLAYER_STATUS
chk currvolume defaultvol actualvolume defaultvol
get player CHK_PLAYER_SONG
chk p-duration 20000
msg main MUSICQ_SET_PLAYBACK 1
msg main CHK_MAIN_SET_MAXPLAYTIME 360000
msg main MUSICQ_SET_PLAYBACK 0
msg main CHK_MAIN_SET_MAXPLAYTIME 360000
end


test 150-20 Gap
msg main MUSICQ_SET_PLAYBACK 0
msg main MUSICQ_SET_PLAYBACK 1
msg main CHK_MAIN_SET_QUEUE_ACTIVE 1
msg main CHK_MAIN_SET_GAP 0
msg main MUSICQ_SET_PLAYBACK 0
msg main QUEUE_PLAYLIST 0~test-sl-a
msg main QUEUE_PLAYLIST 1~test-sl-a
msg main CMD_PLAY
#
resptimeout 2000
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1500
get player CHK_PLAYER_STATUS
chk currvolume defaultvol actualvolume defaultvol
msg player PLAY_FADE
resptimeout 4500
get player CHK_PLAYER_STATUS
# should be a gap
wait playstate in-gap
resptimeout 2500
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1500
get player CHK_PLAYER_STATUS
chk currvolume defaultvol actualvolume defaultvol
#
msg player PLAY_FADE
resptimeout 4500
get player CHK_PLAYER_STATUS
# should be a gap
wait playstate in-gap
resptimeout 2500
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1500
get player CHK_PLAYER_STATUS
chk currvolume defaultvol actualvolume defaultvol
#
msg main MUSICQ_SET_PLAYBACK 1
msg player PLAY_FADE
resptimeout 7500
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1500
get player CHK_PLAYER_STATUS
chk currvolume defaultvol actualvolume defaultvol
msg player PLAY_FADE
resptimeout 4500
get player CHK_PLAYER_STATUS
wait playstate in-fadeout
wait-not playstate in-fadeout
# should not be a gap
chk-or playstate stopped loading playing
wait playstate playing
mssleep 1500
get player CHK_PLAYER_STATUS
chk currvolume defaultvol actualvolume defaultvol
#
msg player PLAY_FADE
resptimeout 7500
get player CHK_PLAYER_STATUS
wait playstate in-fadeout
wait-not playstate in-fadeout
# should not be a gap
chk-or playstate stopped loading playing
wait playstate playing
mssleep 1500
get player CHK_PLAYER_STATUS
chk currvolume defaultvol actualvolume defaultvol
#
msg main MUSICQ_SET_MANAGE 1
msg main MUSICQ_SET_PLAYBACK 0
msg player PLAY_FADE
resptimeout 4500
get player CHK_PLAYER_STATUS
# should be a gap
wait playstate in-gap
resptimeout 2500
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1500
get player CHK_PLAYER_STATUS
chk currvolume defaultvol actualvolume defaultvol
#
msg player PLAY_FADE
resptimeout 4500
get player CHK_PLAYER_STATUS
# should be a gap
wait playstate in-gap
resptimeout 2500
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1500
get player CHK_PLAYER_STATUS
chk currvolume defaultvol actualvolume defaultvol
#
msg player PLAY_FADE
resptimeout 7500
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1500
get player CHK_PLAYER_STATUS
chk currvolume defaultvol actualvolume defaultvol
#
msg main MUSICQ_SET_PLAYBACK 1
msg player PLAY_FADE
resptimeout 4500
get player CHK_PLAYER_STATUS
wait playstate in-fadeout
wait-not playstate in-fadeout
# should not be a gap
chk-or playstate stopped loading playing
wait playstate playing
mssleep 1500
get player CHK_PLAYER_STATUS
chk currvolume defaultvol actualvolume defaultvol
#
msg player PLAY_FADE
resptimeout 7500
get player CHK_PLAYER_STATUS
wait playstate in-fadeout
wait-not playstate in-fadeout
# should not be a gap
chk-or playstate stopped loading playing
wait playstate playing
mssleep 1500
get player CHK_PLAYER_STATUS
chk currvolume defaultvol actualvolume defaultvol
end


# check playback with no fade-in set
test 150-30 Fade-In
msg player PLAYER_VOLUME 30
msg main MUSICQ_SET_PLAYBACK 0
msg main MUSICQ_SET_PLAYBACK 1
msg main CHK_MAIN_SET_QUEUE_ACTIVE 1
msg main CHK_MAIN_SET_FADEIN 0
msg main MUSICQ_SET_PLAYBACK 0
msg main QUEUE_PLAYLIST 0~test-sl-a
msg main QUEUE_PLAYLIST 1~test-sl-a
msg main CMD_PLAY
#
resptimeout 3000
get player CHK_PLAYER_STATUS
wait playstate playing
chk-lt actualvolume 30
mssleep 1500
get player CHK_PLAYER_STATUS
chk actualvolume 30
#
msg main MUSICQ_SET_PLAYBACK 1
resptimeout 7500
msg player PLAY_FADE
get player CHK_PLAYER_STATUS
wait playstate playing
chk actualvolume 30
mssleep 1500
get player CHK_PLAYER_STATUS
chk actualvolume 30
#
msg main MUSICQ_SET_PLAYBACK 0
resptimeout 7500
msg player PLAY_FADE
get player CHK_PLAYER_STATUS
wait playstate playing
chk-lt actualvolume 30
mssleep 1500
get player CHK_PLAYER_STATUS
chk actualvolume 30
#
msg main MUSICQ_SET_MANAGE 1
msg main MUSICQ_SET_PLAYBACK 1
resptimeout 7500
msg player PLAY_FADE
get player CHK_PLAYER_STATUS
wait playstate playing
chk actualvolume 30
mssleep 1500
get player CHK_PLAYER_STATUS
chk actualvolume 30
#
msg main MUSICQ_SET_PLAYBACK 1
msg main CHK_MAIN_SET_FADEIN 400
msg main MUSICQ_SET_PLAYBACK 0
end


# check playback with no fade-out set
test 150-40 Fade-Out
msg player PLAYER_VOLUME 30
msg main MUSICQ_SET_PLAYBACK 0
msg main MUSICQ_SET_PLAYBACK 1
msg main CHK_MAIN_SET_QUEUE_ACTIVE 1
msg main CHK_MAIN_SET_FADEOUT 0
msg main MUSICQ_SET_PLAYBACK 0
msg main QUEUE_PLAYLIST 0~test-sl-a
msg main QUEUE_PLAYLIST 1~test-sl-a
msg main CMD_PLAY
#
resptimeout 3000
get player CHK_PLAYER_STATUS
wait playstate playing
mssleep 1500
#
msg main MUSICQ_SET_PLAYBACK 1
resptimeout 7500
msg player PLAY_FADE
get player CHK_PLAYER_STATUS
# fade-out is active (from queue 0)
wait playstate in-fadeout
wait playstate playing
mssleep 1500
#
msg main MUSICQ_SET_PLAYBACK 0
resptimeout 7500
msg player PLAY_FADE
get player CHK_PLAYER_STATUS
# fade-out is not active (from queue 1)
wait-not playstate in-fadeout
wait playstate playing
mssleep 1500
#
msg main MUSICQ_SET_MANAGE 1
msg main MUSICQ_SET_PLAYBACK 1
resptimeout 7500
msg player PLAY_FADE
get player CHK_PLAYER_STATUS
# fade-out is active (from queue 0)
wait playstate in-fadeout
wait playstate playing
mssleep 1500
#
msg main MUSICQ_SET_PLAYBACK 0
resptimeout 7500
msg player PLAY_FADE
get player CHK_PLAYER_STATUS
# fade-out is not active (from queue 1)
wait-not playstate in-fadeout
wait playstate playing
mssleep 1500
#
end


